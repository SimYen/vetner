<div class="container-fluid" style="margin-top: 1rem; margin-bottom: 2rem;">
  <% if notice %>
    <div class="row">
      <div class="col">
        <div class="alert alert-info alert-dismissible fade show" role="alert">
          <p id="notice" class="p-0 m-0">
            <%= notice %>
          </p>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
    </div>
  <% end %>
  <div class="row justify-content-center align-items-end">
    <h2>SVA Registered Veterinary Centres</h2>
  </div>
  <div class="row">
    <div class="col-12 col-md-5">
      <span class="align-middle">
        <% if user_signed_in? %>
          <iframe src=<%=@address %> height="85%" width="100%" scrolling="no" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
        <% else %>
          <iframe src=<%=@address %> height="85%" width="100%" scrolling="no" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
        <% end %>
      </span>
    </div>
    <div class="col-12 col-md-7 custom-scroll">
      <% if @vet_profiles.length == 0 %>
        <div class="alert alert-warning" role="alert">
          No result found.
        </div>
      <% end %>
      <div class="row">
      <%# <div class="row justify-content-center align-items-end"> %>
        <!-- loop through vet profiles and render each one of them as a card -->
        <% @vet_profiles.each do |vet_profile| %>
          <div class="col-12 col-md-6 col-lg-4 my-2">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title text-center">
                  <i class="fas fa-clinic-medical mr-1"></i>
                  <%= link_to vet_profile.clinic_name, vet_profile_path(id: vet_profile.vet_id) %>
                </h5>
                <p class="card-text">
                  <i class="fas fa-map-marker-alt mr-2"></i>
                  <%= vet_profile.address %><br>
                  <%= vet_profile.unit %><br>
                  <i class="fas fa-phone mr-2"></i>
                  <a href=<%= "tel:+65-#{vet_profile.phone}" %>><%= vet_profile.phone %></a>
                </p>
                  <% if user_signed_in? %>
                    <!-- ******************************************************************-->
                    <!-- start of conditional logic check for showing the "add vet" button -->
                    <!-- if the current user has already added a vet before -->
                    <% if current_user.vets %>
                      <!-- check if a vet profile is found in the current user's list of vets -->
                      <!-- retrieve an array of vet ids of the current user's vets -->
                      <% current_user_vet_profiles = current_user.vets.map(&:vet_profile) %>
                      <% current_user_vet_ids = current_user_vet_profiles.map do |vp| vp.map(&:id) end.flatten(1) %>
                      <!-- if a vet profile's vet id is found in the array of vet ids -->
                      <% if current_user_vet_ids.include? vet_profile.id %>
                        <!-- show the "added" button -->
                        <div class="mt-auto text-center">
                            <button class="btn btn-info" disabled><i class="fas fa-check-circle mr-2"></i>Added to My Vets</button> 
                        </div>
                      <% else %>
                        <!-- show the "add vet" button  -->
                        <%= form_with(scope: :add_vet_to_user, url: add_vet_to_user_path(vet_profile.vet_id), html: {class: 'mt-auto align-self-center'}, local: true) do |f| %>
                          <%= f.hidden_field :vet_id, value: vet_profile.vet_id %>
                          <%= button_tag(type: 'submit', class: "btn btn-success") do %>
                            <i class="fas fa-plus-circle mr-2"></i>Add Vet
                          <% end %>
                        <% end %>
                      <% end %>
                    <% else %>
                      <!-- if the user's list of vets is empty -->
                      <!-- show the "add vet" button -->
                      <%= form_with(scope: :add_vet_to_user, url: add_vet_to_user_path(vet_profile.vet_id), html: {class: 'mt-auto align-self-center'}, local: true) do |f| %>
                        <%= f.hidden_field :vet_id, value: vet_profile.vet_id %>
                        <%= button_tag(type: 'submit', class: "btn btn-success") do %>
                          <i class="fas fa-plus-circle mr-2"></i>Add Vet
                        <% end %>
                      <% end %>
                    <% end %>
                    <!-- end of conditional logic check for showing the "add vet" button -->
                    <!--**************************************************************** -->
                  <% end %></span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
